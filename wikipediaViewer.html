<!DOCTYPE html>
<html>
<head>
	<title>Wikipedia Viewer</title>
	<style>
		.spinner { position: relative; }

		.spinner:after {
			content: '';
			box-sizing: border-box;
			position: absolute;
			/*top: 50%;
			left: 50%;*/
			width: 20px;
			height: 20px;
			/*margin-top: -10px;*/
			margin-left: 10px;
			border-radius: 50%;
			border: 2px solid #ccc;
			border-top-color: #333;
			animation: spinner .6s linear infinite;
		}

		@keyframes spinner {
			to {transform: rotate(360deg);}
		}

	</style>
</head>

<body>
	<div id="wrapper">
		<form id="searchForm" action="#">
			<input type="text" name="searchTerm" id="searchTerm">
			<input type="submit" style="position: absolute; left: -9999px"/>
		</form>
		<ul id="resultList">

		</ul>
	</div>
	<script>

		var list = document.getElementById('resultList');
		var searchTermElement = document.getElementById('searchTerm');
		var searchForm = document.getElementById('searchForm');


		searchTermElement.addEventListener('keypress', function(evt){
			console.log(evt);
			if (evt.keyCode == 13 || evt.keyCode == 13) {
				evt.preventDefault(); 
				console.log(evt);
				toggleSpinner();
				document.getElementById("resultList").innerHTML = "";
				fetchSearchResults(searchTermElement.value)
				
			} else {console.log(evt.keyCode);}
		}, false);

		function fetchSearchResults(searchTerm){
			fetch('https://en.wikipedia.org/w/api.php?action=query&format=json&prop=extracts&generator=search&exlimit=10&exsentences=6&exintro=1&explaintext=1&gsrsearch=' + searchTerm).then(function(response) {
				return response.json();
			}).then(function(response){
				toggleSpinner();
				var result = response['query']['pages'];
				console.log(result);
				Object.keys(result).forEach(function(item){
					var entry = document.createElement('li');
					entry.appendChild(document.createTextNode(result[item]['title']));
					list.appendChild(entry);
					console.log(result[item]['title'])
				})
			});
		}

		function toggleSpinner(){
			var inp = document.getElementById('searchForm');
			inp.classList.toggle("spinner");
		}
	</script>
</body>

</html>